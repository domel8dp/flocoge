/***************************************************************
 *                                                             *
 *                   DO NOT MODIFY THIS FILE                   *
 *                                                             *
 * This file was generated by the flocoge tool. Any changes in *
 * this file will be lost on next file generation.             *
 * Generated by: flocoge-0.0.1                                 *
 * Generated on: 2015-11-18 23:09:34 +0100                     *
 ***************************************************************/

package pl.dpawlak.flocoge.diagram;


public class MergePointsFacade {

    private final MergePoints mergePoints;

    public MergePointsFacade(MergePoints mergePoints) {
        this.mergePoints = mergePoints;
    }

    public void inspectNode() {
        if (mergePoints.idInNode()) {
            if (mergePoints.indexInNode()) {
                if (mergePoints.allBranchesEqual()) {
                    mergePoints.loopDetected();
                    mergePoints.markInvalid();
                } else {
                }
            } else {
                if (mergePoints.mergePointExistsForThisIndex()) {
                    mergePoints.saveIndexInNode();
                } else {
                    saveMergePoint();
                }
            }
        } else {
            mergePoints.saveDecisionIdInNode();
        }
    }

    private void saveMergePoint() {
        if (mergePoints.otherMergePointExists()) {
            if (mergePoints.sameMergePoint()) {
                verifyOpenBranches();
                mergePoints.saveMergePointForBranch();
            } else {
                mergePoints.improperBranchingDetected();
                mergePoints.markInvalid();
            }
        } else {
            verifyOpenBranches();
            mergePoints.saveMergePointOnBothBranches();
        }
    }

    private void verifyOpenBranches() {
        if (mergePoints.anyDecisionBranchClosed()) {
            mergePoints.interleavedBranchingDetected();
            mergePoints.markInvalid();
        } else {
            mergePoints.removeFromOpenDecisions();
        }
    }

}
